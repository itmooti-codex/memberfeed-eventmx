<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Forum Feed</title>

    <link rel="stylesheet" href="styles/style.css" />
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- ‚úÖ Plyr -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/plyr@3.7.8/dist/plyr.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/plyr@3.7.8/dist/plyr.polyfilled.min.js"></script>
    <script src="https://unpkg.com/filepond-plugin-file-validate-type/dist/filepond-plugin-file-validate-type.js"></script>
    <script src="https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.js"></script>
    <script src="https://unpkg.com/filepond-plugin-media-preview/dist/filepond-plugin-media-preview.js"></script>
    <script src="https://unpkg.com/filepond-plugin-file-poster/dist/filepond-plugin-file-poster.js"></script>
    <script src="https://unpkg.com/filepond/dist/filepond.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/tributejs@5.1.3/dist/tribute.css"
    />
    <link
      href="https://unpkg.com/filepond/dist/filepond.css"
      rel="stylesheet"
    />
    <link
      href="https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.css"
      rel="stylesheet"
    />
    <link
      href="https://unpkg.com/filepond-plugin-media-preview/dist/filepond-plugin-media-preview.css"
      rel="stylesheet"
    />
    <link
      href="https://unpkg.com/filepond-plugin-file-poster/dist/filepond-plugin-file-poster.css"
      rel="stylesheet"
    />
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsrender/jsrender.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.2/dist/purify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tributejs@5.1.3/dist/tribute.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>
  </head>

  <body

    x-data="{
    showNotifications: false,
    showSettings: false,
    openSettings:false,

   
}"
    class="max-w-[700px] bg-[#f1f1f1] flex flex-col items-center justify-center m-auto p-6 max-[768px]:p-2"
  >
    <div class="relative">
      <button
        @click="showNotifications = !showNotifications"
        class="p-2 bg-white rounded-full shadow-md hover:bg-gray-100 focus:outline-none"
      >
        <i class="fa-solid fa-bell text-gray-600"></i>
      </button>
      <div
        x-data="{
      hasUnread: false,
      init() {
        this.checkUnread();
        this.$watch('hasUnread', value => {
        });

        setInterval(() => {
          this.checkUnread();
        }, 1000);
      },
      checkUnread() {
        const container = document.getElementById('notificationContainerSocket');
        this.hasUnread = container && container.querySelector('.unread') !== null;
      }
    }"
        x-show="hasUnread"
        x-cloak
        class="absolute top-0 right-0 -mt-1 -mr-1"
      >
        <span class="relative flex size-2">
          <span
            class="absolute inline-flex h-full w-full animate-ping rounded-full bg-red-400 opacity-75"
          ></span>
          <span
            class="relative inline-flex size-2 rounded-full bg-red-500"
          ></span>
        </span>
      </div>

      <!-- Notification Panel -->
      <div
        x-show="showNotifications"
        @click.outside="showNotifications = false"
        x-transition
        class="absolute right-0 mt-2 w-96 bg-white rounded-lg shadow-lg z-50 p-4"
      >
        <div class="flex items-center justify-between mb-3">
          <h3 class="font-semibold text-lg">Notifications</h3>
          <div class="flex items-center gap-3 text-gray-500">
            <button
              @click="openSettings=true;showNotifications=false"
              x-tooltip="'Settings'"
              class="hover:text-blue-600"
            >
              <i class="fa-solid fa-gear"></i>
            </button>
            <button
              @click="showNotifications = false"
              x-tooltip="'Close'"
              class="hover:text-red-500"
            >
              <i class="fa-solid fa-xmark"></i>
            </button>
          </div>
        </div>

        <div class="flex items-center justify-between mb-3">
          <button
            id="markAllNotificationAsRead"
            x-tooltip="'Mark all as read'"
            class="text-blue-600 hover:text-blue-800"
          >
            <i class="fa-solid fa-envelope-open"></i>
          </button>
          <div
            x-data="{ toggle: false }"
            x-init="$watch('toggle', value => {
                const hideEls = document.querySelectorAll('.read');
                const unreadEls = document.querySelectorAll('.unread');
                const noNotif = document.getElementById('noNotification');
                const mainNotificationContainer = document.getElementById('notificationContainerSocket');

                hideEls.forEach(el => el.classList.toggle('hidden', value));

                if (value && unreadEls.length === 0 && noNotif) {
                  noNotif.classList.remove('hidden');
                  mainNotificationContainer.classList.add('hidden');
                } else if (noNotif) {
                  mainNotificationContainer.classList.remove('hidden');
                  noNotif.classList.add('hidden');
                }
            })"
          >
            <label
              class="flex items-center gap-2 text-sm text-gray-600 cursor-pointer"
            >
              <div
                class="relative h-4 w-8 rounded-full transition duration-200 ease-linear"
                :class="toggle ? 'bg-[var(--primary)]' : 'bg-gray-400'"
              >
                <div
                  class="absolute left-0 h-4 w-4 transform rounded-full border-2 bg-white transition duration-100 ease-linear"
                  :class="toggle ? 'translate-x-full border-[var(--primary)]' : 'translate-x-0 border-gray-400'"
                ></div>
                <input
                  type="checkbox"
                  class="absolute h-full w-full opacity-0 cursor-pointer"
                  @click="toggle = !toggle"
                />
              </div>
              Show unread only
            </label>
          </div>
        </div>
        <div>
          <div
            id="notificationContainerSocket"
            class="flex flex-col gap-2 max-h-[350px] min-h-[100px] h-auto overflow-y-auto"
          ></div>
          <div class="text-gray-500 text-sm p-4 hidden" id="noNotification">
            No notifications
          </div>
        </div>

        <script id="notificationTemplate" type="text/x-jsrender">
          <div class="notification {{if Is_Read}}read{{else}}unread{{/if}} cursor-pointer flex items-start gap-3 rounded-lg p-3 hover:bg-gray-100" data-announcement="{{:ID}}">
            <i class="fa-solid fa-file-alt mt-1 text-lg text-indigo-500"></i>
            <div class="flex-1">
              <div class="text-md font-medium text-gray-900">{{:Title}}</div>
              <div class="text-sm line-clamp-1 font-medium text-gray-900">{{:Parent_Forum?.copy}}</div>
              <div class="text-xs text-gray-500">{{:~formatDate(Parent_Forum?.published_date)}}</div>
            </div>
          </div>
        </script>

        <div class="mt-2 flex justify-end">
          <button
            x-tooltip="'View all'"
            class="text-blue-600 hover:text-blue-800"
          >
            <i class="fa-solid fa-arrow-right"></i>
          </button>
        </div>
      </div>

      <!-- Settings Panel -->
      <div
       id="notification-Settings" 
        x-show="openSettings"
        x-transition
        class="absolute right-0 mt-2 w-96 bg-white rounded-lg shadow-lg z-50 p-4"
      >
        <div class="flex items-center justify-between mb-4">
          <h3 class="font-semibold text-lg">Notification Preferences</h3>
          <button
            @click="openSettings=false"
            x-tooltip="'Close'"
            class="hover:text-red-500 text-gray-500"
          >
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>

        <div class="space-y-3 text-sm text-gray-800">
          <div class="space-y-3 text-sm text-gray-800" id="notificationOptionsContainer">
            </div>
            <div class="pt-4 text-right" id="updatePreferenceButton">
              <button onclick="updateNotificationPreferences()"
                class="px-4 py-2 bg-[var(--primary)] text-white rounded hover:opacity-90 transition">
                Save Preferences
              </button>
            </div>
        </div>
      </div>
    </div>

    <div x-data="{modalToSelectUser: true}">
      <button
        @click="switchUser=true; modalToSelectUser=true"
        class="my-8 block"
      >
        Switch User
      </button>
      <div
        x-cloak
        x-show="modalToSelectUser"
        x-transition.opacity.duration.200ms
        x-trap.inert.noscroll="modalToSelectUser"
        class="fixed inset-0 z-30 flex items-end justify-center bg-black/20 p-4 pb-8 backdrop-blur-md sm:items-center lg:p-8"
        role="dialog"
        aria-modal="true"
        aria-labelledby="defaultModalTitle"
      >
        <!-- Modal Dialog -->
        <div
          x-show="modalToSelectUser"
          x-transition:enter="transition ease-out duration-200 delay-100 motion-reduce:transition-opacity"
          x-transition:enter-start="opacity-0 scale-50"
          x-transition:enter-end="opacity-100 scale-100"
          class="flex max-w-lg flex-col gap-4 overflow-hidden rounded-radius bg-white rounded"
        >
          <!-- Dialog Header -->
          <div
            class="flex items-center justify-between bg-surface-alt/60 p-4 dark:bg-surface-dark/20"
          >
            <h3
              id="defaultModalTitle"
              class="font-semibold tracking-wide text-on-surface-strong dark:text-on-surface-dark-strong"
            >
              Select Profile
            </h3>
          </div>
          <!-- Dialog Body -->
          <div class="px-4 pb-4" x-data="{activeUserTab: 'subscribers'}">
            <div class="flex gap-4 mb-4">
              <button
                :class="{'font-bold': activeUserTab==='subscribers'}"
                @click="activeUserTab='subscribers'"
              >
                Subscribers
              </button>
              <button
                :class="{'font-bold': activeUserTab==='admins'}"
                @click="activeUserTab='admins'"
              >
                Admins
              </button>
            </div>
            <div
              id="subscriberContacts"
              x-show="activeUserTab==='subscribers'"
              class="flex h-[100px] items-center justify-center"
            >
              <div class="flex w-12">
                <div class="relative">
                  <div
                    class="w-12 h-12 rounded-full absolute border border-solid border-gray-200"
                  ></div>
                  <div
                    class="w-12 h-12 rounded-full animate-spin absolute border border-solid border-yellow-500 border-t-transparent"
                  ></div>
                </div>
              </div>
            </div>
            <div
              id="adminContacts"
              x-show="activeUserTab==='admins'"
              class="flex h-[100px] items-center justify-center"
            ></div>
          </div>
        </div>
      </div>
    </div>

    <div id="topOfForum"></div>

    <div
      onclick="document.getElementById('topOfForum').scrollIntoView({ behavior: 'smooth' })"
      class="p-3 bg-[var(--primary)] flex items-center justify-center cursor-pointer fixed bottom-[1rem] right-[1rem] max-[768px]:hidden z-[99]"
    >
      <i class="fa-solid fa-arrow-up text-white"></i>
    </div>

    <div
      id="create-post-trigger"
      class="bg-white shadow-lg rounded w-full p-4 flex items-center cursor-pointer mb-4"
    >
      <span class="text-gray-500">What's on your mind?</span>
      <span id="current-user-name" class="ml-2 text-gray-700"></span>
      <img
        id="current-user-avatar"
        src="https://files.ontraport.com/media/b0456fe87439430680b173369cc54cea.php03bzcx?Expires=4895186056&Signature=fw-mkSjms67rj5eIsiDF9QfHb4EAe29jfz~yn3XT0--8jLdK4OGkxWBZR9YHSh26ZAp5EHj~6g5CUUncgjztHHKU9c9ymvZYfSbPO9JGht~ZJnr2Gwmp6vsvIpYvE1pEywTeoigeyClFm1dHrS7VakQk9uYac4Sw0suU4MpRGYQPFB6w3HUw-eO5TvaOLabtuSlgdyGRie6Ve0R7kzU76uXDvlhhWGMZ7alNCTdS7txSgUOT8oL9pJP832UsasK4~M~Na0ku1oY-8a7GcvvVv6j7yE0V0COB9OP0FbC8z7eSdZ8r7avFK~f9Wl0SEfS6MkPQR2YwWjr55bbJJhZnZA__&Key-Pair-Id=APKAJVAAMVW6XQYWSTNA"
        alt="avatar"
        class="w-8 h-8 rounded-full ml-auto"
      />
    </div>

    <div
      id="create-post-modal"
      class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50"
    >
      <div
        class="bg-white p-4 rounded shadow-lg w-[90%] max-w-lg relative createPostMainModal"
      >
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-lg font-bold">Create a Post</h2>
          <button id="close-post-modal">
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>
        <div id="post-creation-form" class="post-form">
          <div class="toolbar">
            <button data-cmd="bold"><b>B</b></button>
            <button data-cmd="italic"><i>I</i></button>
            <button data-cmd="underline"><u>U</u></button>
            <button data-cmd="link"><i class="fa-solid fa-link"></i></button>
          </div>
          <div
            id="post-editor"
            class="editor min-h-[80px] resize-y p-2 rounded"
            contenteditable="true"
            data-placeholder="Write a post..."
          ></div>
          <div class="upload-section">
            <div class="flex item-center gap-4 my-4">
              <div class="emoji-wrapper relative">
                <button type="button" class="emoji-toggle">üòä</button>
                <div
                  class="emoji-picker hidden absolute bg-white border rounded shadow-md p-1 mt-1 z-10"
                >
                  <span class="cursor-pointer px-1 hover:bg-[var(--primary)]"
                    >üòÄ</span
                  >
                  <span class="cursor-pointer px-1 hover:bg-[var(--primary)]"
                    >üòÇ</span
                  >
                  <span class="cursor-pointer px-1 hover:bg-[var(--primary)]"
                    >üòç</span
                  >
                  <span class="cursor-pointer px-1 hover:bg-[var(--primary)]"
                    >üëç</span
                  >
                  <span class="cursor-pointer px-1 hover:bg-[var(--primary)]"
                    >üëé</span
                  >
                  <span class="cursor-pointer px-1 hover:bg-[var(--primary)]"
                    >ü§î</span
                  >
                  <span class="cursor-pointer px-1 hover:bg-[var(--primary)]"
                    >üò¢</span
                  >
                  <span class="cursor-pointer px-1 hover:bg-[var(--primary)]"
                    >üéâ</span
                  >
                  <span class="cursor-pointer px-1 hover:bg-[var(--primary)]"
                    >üöÄ</span
                  >
                  <span class="cursor-pointer px-1 hover:bg-[var(--primary)]"
                    >ü•≥</span
                  >
                </div>
              </div>
              <button id="recordBtn" class="recordBtn">
                <i class="fa-solid fa-microphone"></i> Start Recording
              </button>
              <div
                x-data="{ openScheduleDatePicker: false, selectedDate: '', today: new Date().toISOString().split('T')[0] }"
                class="relative inline-block text-left hidden"
                id="adminSchedulePostButton"
              >
                <!-- Trigger Button -->
                <span id="scheduledDateContainer" class="hidden"></span>
                <button
                  @click="openScheduleDatePicker = !openScheduleDatePicker"
                  class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
                >
                  Pick a Date
                </button>

                <!-- Dropdown -->
                <div
                  x-show="openScheduleDatePicker"
                  @click.outside="openScheduleDatePicker = false"
                  class="absolute mt-2 w-64 bg-white shadow-lg rounded border p-4 z-50"
                  x-transition
                >
                  <label
                    for="datePicker"
                    class="block text-sm text-gray-700 mb-2"
                    >Select a date:</label
                  >

                  <!-- Native Date Picker -->
                  <input
                    type="datetime-local"
                    id="datePicker"
                    x-model="selectedDate"
                    :min="today"
                    class="w-full px-3 py-2 border rounded focus:outline-none focus:ring focus:border-blue-300"
                  />

                  <!-- Display Selected -->
                  <p class="mt-3 text-sm text-gray-600" x-show="selectedDate">
                    Selected:
                    <span
                      class="font-medium text-gray-800"
                      x-text="selectedDate"
                    ></span>
                  </p>

                  <!-- Schedule Button -->
                  <button
                    @click="
                        const ts = new Date(selectedDate).getTime() / 1000;
                        document.getElementById('scheduledDateContainer').innerText = ts;
                        openScheduleDatePicker = false;
                        createForumToSubmit('0','Post','post-form');
                      "
                    class="mt-4 w-full bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 disabled:opacity-50"
                    :disabled="!selectedDate"
                  >
                    Schedule
                  </button>
                </div>
              </div>
            </div>
            <input
              type="file"
              id="file-input"
              class="file-input"
              style="display: none"
              accept="image/*,audio/*,video/*,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document"
            />
            <canvas
              class="canvasWaveform waveform w-full"
              id="waveform"
              width="450"
              height="100"
            ></canvas>
          </div>
        </div>
        <button
          id="submitForumPost"
          onclick="createForumToSubmit('0','Post','post-form');"
        >
          Post
        </button>
        <!-- <button class="ml-auto block" id="submit-post">Post</button> -->
      </div>
    </div>

    <div
      id="post-filters"
      class="bg-white post-filters w-full shadow-lg p-4 flex items-center flex-col my-4 rounded"
    >
      <div
        class="flex items-center justify-between w-full max-[500px]:flex-col max-[500px]:items-start max-[500px]:gap-4"
      >
        <div class="flex items-center gap-4">
          <button class="filter-btn active" data-filter="Recent">
            <i class="fa-solid fa-clock"></i>
          </button>
          <button class="filter-btn" data-filter="Featured">
            <i class="fa-solid fa-star"></i>
          </button>
          <button class="filter-btn" data-filter="My Posts">
            <i class="fa-solid fa-user"></i>
          </button>
          <button class="filter-btn" data-filter="Saved Posts">
            <i class="fa-solid fa-bookmark"></i>
          </button>
        </div>

        <div class="flex items-center gap-4">
          <div class="sort-filter relative">
            <button id="sort-filter-btn" class="filter-btn">Latest ‚ñæ</button>
            <ul
              id="sort-filter-menu"
              class="sort-filter-menu absolute top-[100%] right-0 bg-[#ffffff] border border-1-[#ccc] list-style-none p-0 mr-[4px] w-fit z-[10]"
            >
              <li class="py-2 px-8 cursor-pointer active" data-sort="Latest">
                Latest
              </li>
              <li class="py-2 px-8 cursor-pointer" data-sort="Oldest">
                Oldest
              </li>
              <li
                class="py-2 px-8 cursor-pointer text-nowrap"
                data-sort="Most Popular"
              >
                Most Popular
              </li>
            </ul>
          </div>
          <div class="file-filter relative">
            <button id="file-filter-btn" class="filter-btn">All ‚ñæ</button>
            <ul
              id="file-filter-menu"
              class="file-filter-menu absolute top-[100%] right-0 bg-[#ffffff] border border-1-[#ccc] list-style-none p-0 mr-[4px] min-w-[6em] z-[10]"
            >
              <li
                class="py-2 px-8 cursor-pointer"
                data-type="All"
                class="active"
              >
                All
              </li>
              <li class="py-2 px-8 cursor-pointer" data-type="Image">Image</li>
              <li class="py-2 px-8 cursor-pointer" data-type="Video">Video</li>
              <li class="py-2 px-8 cursor-pointer" data-type="Audio">Audio</li>
              <li class="py-2 px-8 cursor-pointer" data-type="File">File</li>
            </ul>
          </div>
        </div>
      </div>
      <div class="search-wrapper w-full my-4 relative">
        <input
          type="text"
          id="searchPost"
          class="py-2 px-4 rounded text-sm"
          placeholder="Search by author or text‚Ä¶"
          autocomplete="off"
        />
        <span
          class="clearIcon hidden absolute top-[50%] right-[8px] cursor-pointer text-sm translate-y-[-50%]"
          ><i class="fa-solid fa-xmark"></i
        ></span>
        <span
          class="searchIcon absolute top-[50%] right-[8px] cursor-pointer text-sm translate-y-[-50%]"
          ><i class="fa-solid fa-search"></i
        ></span>
      </div>
    </div>

    <div class="tabs mb-4 hidden" id="tabsForAdmin">
      <button id="publishedTab" class="px-4 py-2 bg-blue-500 text-white mr-2">
        Published
      </button>
      <button id="scheduledTab" class="px-4 py-2 bg-gray-300 text-black">
        Scheduled
      </button>
    </div>

    <div id="skeleton-loader" class="w-full">
      <div class="skeleton-item flex gap-4 p-4 mb-4 bg-white rounded shadow">
        <div class="skeleton-avatar"></div>
        <div class="flex-1 flex flex-col gap-2">
          <div class="skeleton-line short"></div>
          <div class="skeleton-line"></div>
          <div class="skeleton-line medium"></div>
        </div>
      </div>
      <div class="skeleton-item flex gap-4 p-4 mb-4 bg-white rounded shadow">
        <div class="skeleton-avatar"></div>
        <div class="flex-1 flex flex-col gap-2">
          <div class="skeleton-line short"></div>
          <div class="skeleton-line"></div>
          <div class="skeleton-line medium"></div>
        </div>
      </div>
      <div class="skeleton-item flex gap-4 p-4 mb-4 bg-white rounded shadow">
        <div class="skeleton-avatar"></div>
        <div class="flex-1 flex flex-col gap-2">
          <div class="skeleton-line short"></div>
          <div class="skeleton-line"></div>
          <div class="skeleton-line medium"></div>
        </div>
      </div>
    </div>

    <div id="forum-root" class="w-full"></div>

    <!-- Delete confirmation modal -->
    <div
      id="delete-modal"
      class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50"
    >
      <div class="bg-white p-4 rounded shadow-lg w-[90%] max-w-sm">
        <h2 id="delete-modal-title" class="text-lg font-bold mb-4"></h2>
        <div class="flex justify-end gap-2">
          <button
            id="delete-confirm"
            class="bg-red-500 text-white px-4 py-1 rounded"
          >
            Delete
          </button>
          <button id="delete-cancel" class="bg-gray-300 px-4 py-1 rounded">
            Cancel
          </button>
        </div>
      </div>
    </div>

    <script id="tmpl-item" type="text/x-jsrender">
           {{if (forumType === 'Post' || forumType === 'Reply' || forumType === 'Comment') && (forumStatus === 'Published - Not flagged' || (forumStatus === 'Scheduled' && isAdmin))}}
             <div
               class="item rounded bg-white shadow-xl flex flex-col gap-2 my-4 p-4 relative border-2 border-[#e9ebee] "
               data-uid="{{:uid}}"
               data-depth="{{:depth}}"
               data-forumStatus="{{:forumStatus}}"
               style="{{if isAdmin && forumStatus === 'Scheduled'}}display:none;{{/if}}"
               >
               <div class="flex items-start justify-between">
               <div class="author flex items-center mb-2">
                 <img class="avatar w-[40px] h-[40px] bg-[#ccc] rounded-full mr-[12px]"
                     src="{{:authorImage}}"
                     alt="{{:authorName}}"
                     onerror="this.onerror=null;this.src='https://files.ontraport.com/media/b0456fe87439430680b173369cc54cea.php03bzcx?Expires=4895186056&Signature=fw-mkSjms67rj5eIsiDF9QfHb4EAe29jfz~yn3XT0--8jLdK4OGkxWBZR9YHSh26ZAp5EHj~6g5CUUncgjztHHKU9c9ymvZYfSbPO9JGht~ZJnr2Gwmp6vsvIpYvE1pEywTeoigeyClFm1dHrS7VakQk9uYac4Sw0suU4MpRGYQPFB6w3HUw-eO5TvaOLabtuSlgdyGRie6Ve0R7kzU76uXDvlhhWGMZ7alNCTdS7txSgUOT8oL9pJP832UsasK4~M~Na0ku1oY-8a7GcvvVv6j7yE0V0COB9OP0FbC8z7eSdZ8r7avFK~f9Wl0SEfS6MkPQR2YwWjr55bbJJhZnZA__&Key-Pair-Id=APKAJVAAMVW6XQYWSTNA';">
                 <div class="info flex items-center gap-2">
                   <span class="name font-bold">{{:authorName}}</span>
                   <span class="timestamp text-sm text-[#65676b] ml-2">{{:timeAgo}}</span>
                   {{if isFeatured}}
                   <i class="fa-solid fa-star text-yellow-500 ml-2" title="Featured"></i>
                   {{/if}}
                   {{if forumStatus==='Scheduled'}}
                <div class="flex items-center gap-1">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                 <path d="M9 20H6C4.93913 20 3.92172 19.5786 3.17157 18.8284C2.42143 18.0783 2 17.0609 2 16V7C2 5.93913 2.42143 4.92172 3.17157 4.17157C3.92172 3.42143 4.93913 3 6 3H17C18.0609 3 19.0783 3.42143 19.8284 4.17157C20.5786 4.92172 21 5.93913 21 7V10M8 2V4M15 2V4M2 8H21M18.5 15.643L17 17.143" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                 <path d="M17 22C19.7614 22 22 19.7614 22 17C22 14.2386 19.7614 12 17 12C14.2386 12 12 14.2386 12 17C12 19.7614 14.2386 22 17 22Z" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
               </svg>
                   <div class="text-sm text-[#65676b]">{{:~formatDate(sheduledDate)}}</div>
                </div>
                   {{/if}}
                 </div>
               </div>
               {{if canDelete}}
                  <div x-data="{ threeDotsForAdmin: false, openedWithKeyboard: false }" class="relative w-fit" x-on:keydown.esc.window="threeDotsForAdmin = false, openedWithKeyboard = false">
             <!-- Toggle Button -->
             <div x-on:click="threeDotsForAdmin = ! threeDotsForAdmin" aria-haspopup="true" x-on:keydown.space.prevent="openedWithKeyboard = true" x-on:keydown.enter.prevent="openedWithKeyboard = true" class="cursor-pointer" x-on:keydown.down.prevent="openedWithKeyboard = true">
               <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                 <path d="M13 12C13 12.2967 12.912 12.5867 12.7472 12.8334C12.5824 13.08 12.3481 13.2723 12.074 13.3858C11.7999 13.4993 11.4983 13.5291 11.2074 13.4712C10.9164 13.4133 10.6491 13.2704 10.4393 13.0607C10.2296 12.8509 10.0867 12.5836 10.0288 12.2926C9.97094 12.0017 10.0006 11.7001 10.1142 11.426C10.2277 11.1519 10.42 10.9176 10.6666 10.7528C10.9133 10.588 11.2033 10.5 11.5 10.5C11.8978 10.5 12.2794 10.658 12.5607 10.9393C12.842 11.2206 13 11.6022 13 12ZM11.5 5C11.7967 5 12.0867 4.91203 12.3334 4.74721C12.58 4.58238 12.7723 4.34811 12.8858 4.07403C12.9994 3.79994 13.0291 3.49834 12.9712 3.20737C12.9133 2.91639 12.7704 2.64912 12.5607 2.43934C12.3509 2.22956 12.0836 2.0867 11.7926 2.02882C11.5017 1.97094 11.2001 2.00065 10.926 2.11418C10.6519 2.22771 10.4176 2.41997 10.2528 2.66665C10.088 2.91332 10 3.20333 10 3.5C10 3.89783 10.158 4.27936 10.4393 4.56066C10.7206 4.84197 11.1022 5 11.5 5ZM11.5 19C11.2033 19 10.9133 19.088 10.6666 19.2528C10.42 19.4176 10.2277 19.6519 10.1142 19.926C10.0006 20.2001 9.97094 20.5017 10.0288 20.7926C10.0867 21.0836 10.2296 21.3509 10.4393 21.5607C10.6491 21.7704 10.9164 21.9133 11.2074 21.9712C11.4983 22.0291 11.7999 21.9993 12.074 21.8858C12.3481 21.7723 12.5824 21.58 12.7472 21.3334C12.912 21.0867 13 20.7967 13 20.5C13 20.1022 12.842 19.7206 12.5607 19.4393C12.2794 19.158 11.8978 19 11.5 19Z" fill="black" />
               </svg>
             </div>
         <!-- Dropdown Menu -->
         <div x-cloak x-show="threeDotsForAdmin || openedWithKeyboard" x-transition x-trap="openedWithKeyboard" x-on:click.outside="threeDotsForAdmin = false, openedWithKeyboard = false" x-on:keydown.down.prevent="$focus.wrap().next()" x-on:keydown.up.prevent="$focus.wrap().previous()" class="absolute top-11 left-0 flex w-fit min-w-48 flex-col overflow-hidden bg-white shadow-lg z-[999]" role="menu">
           {{if depth === 0}}
             {{if isAdmin}}

             <div data-uid="{{:uid}}" class="btn-delete cursor-pointer px-4 py-2 text-nowrap text-black transition-all hover:bg-[var(--primary)]" role="menuitem">Delete this post</div>
             {{if forumStatus === 'Published - Not flagged'}}
                 {{if !isFeatured}}
                 <div data-uid="{{:uid}}" class="btn-feature cursor-pointer px-4 py-2 text-nowrap text-black transition-all hover:bg-[var(--primary)]" role="menuitem">Mark this post as featured</div>
                 {{else}}
                 <div data-uid="{{:uid}}" class="btn-unfeature cursor-pointer px-4 py-2 text-nowrap text-black transition-all hover:bg-[var(--primary)]" role="menuitem">Remove featured mark</div>
                 {{/if}}
                 {{if commentsDisabled}}
                 <div data-uid="{{:uid}}" class="btn-enable-comments cursor-pointer px-4 py-2 text-nowrap text-black transition-all hover:bg-[var(--primary)]" role="menuitem">Enable comments on this post</div>
                 {{else}}
                 <div data-uid="{{:uid}}" class="btn-disable-comments cursor-pointer px-4 py-2 text-nowrap text-black transition-all hover:bg-[var(--primary)]" role="menuitem">Disable comments on this post</div>
                 {{/if}}
             {{else}}
               <div data-uid="{{:uid}}" class="postNowFromScheduled cursor-pointer px-4 py-2 text-nowrap text-black transition-all hover:bg-[var(--primary)]" role="menuitem">Post Now</div>
             {{/if}}
             {{else}}
             {{if canDelete}}
             <div data-uid="{{:uid}}" class="btn-delete cursor-pointer px-4 py-2 text-nowrap text-black transition-all hover:bg-[var(--primary)]" role="menuitem">Delete this post</div>
             {{/if}}
             {{/if}}
           {{else}}
           {{if canDelete}}
             <div data-uid="{{:uid}}" class="btn-delete cursor-pointer px-4 py-2 text-nowrap text-black transition-all hover:bg-[var(--primary)]" role="menuitem">
               {{if depth === 1}}Delete this comment{{else}}Delete this reply{{/if}}
             </div>
           {{/if}}
           {{/if}}
         </div>
       </div>
       {{/if}}

       </div>
      <div class="content my-2">{{:content}}</div>
         <div class="file-preview">

             {{if fileContent}}
                 {{if fileContent}}
                   {{if fileType === "Image"}}
                     <img src="{{:fileContent}}" style="width:100%;height:300px;object-fit:cover;" alt="preview" />
                   {{else fileType === "Audio"}}
                     <audio class="js-player" controls>
                       <source src="{{:fileContent}}" type="audio/mpeg" />
                       Your browser does not support the audio tag.
                     </audio>
                   {{else fileType === "Video"}}
                     <video class="js-player" controls style="width: 100%; height: auto;">
                       <source src="{{:fileContent}}" type="video/mp4" />
                       Your browser does not support video.
                     </video>
                   {{else}}
                     <a href="{{:fileContent}}" target="_blank" class="line-clamp-1 cursor-pointer text-blue-600 hover:underline">{{:fileContentName}}</a>
                   {{/if}}
                 {{/if}}
           {{/if}}
           {{if depth > 0}}
           {{if fileContentComment}}
                 {{if fileContentComment}}
                   {{if fileType === "Image"}}
                     <img src="{{:fileContentComment || fileContentComment}}" style="width:100%;height:300px;object-fit:cover;" alt="preview" />
                   {{else fileType === "Audio"}}
                     <audio class="js-player" controls>
                       <source src="{{:fileContentComment}}" type="audio/mpeg" />
                       Your browser does not support the audio tag.
                     </audio>
                   {{else fileType === "Video"}}
                     <video class="js-player" controls style="width: 100%; height: auto;">
                       <source src="{{:fileContentComment}}" type="video/mp4" />
                       Your browser does not support video.
                     </video>
                   {{else}}
                     <div>{{:fileContentCommentName}}</div>
                   {{/if}}
                 {{/if}}
               {{/if}}
         {{/if}}

         </div>
       {{if forumStatus === 'Published - Not flagged'}}
               <div class="actions">
                 <div class = "flex items-center justify-between">
                   <div class = "flex items-center gap-4">
                     <button class="btn-like{{:hasUpvoted ? ' liked' : ''}} flex items-center" data-uid="{{:uid}}"><i class="fa-solid fa-thumbs-up"></i> <span class="ml-1">{{:upvotes}}</span></button>
                     {{if !commentsDisabled && forumStatus !== 'Scheduled'}}
                     <button class="btn-comment flex items-center" data-uid="{{:uid}}"><i class="fa-solid fa-comment"></i></button>
                     {{/if}}
                   </div>
                   {{if depth === 0}}
                     <button class="btn-bookmark{{:hasBookmarked ? ' bookmarked' : ''}} flex items-center" data-uid="{{:uid}}"><i class="fa-solid fa-bookmark"></i></button>
                   {{/if}}
                 </div>
               </div>
       {{/if}}
               {{if depth === 0 && forumStatus !== 'Scheduled'}}
               <div class="ribbon w-full my-4 py-2 bg-[#e9ebee] text-center cursor-pointer text-sm hover:bg-[#007bff] hover:text-white" data-uid="{{:uid}}">
         {{:~totalComments(children)}} {{:~totalComments(children) === 1 ? 'Comment' : 'Comments'}}
       </div>

               {{else depth === 1}}
               <div class="ribbon w-full my-4 py-2 bg-[#e9ebee] text-center cursor-pointer text-sm hover:bg-[#007bff] hover:text-white" data-uid="{{:uid}}">
                   {{:children.length}} {{:children.length === 1 ? 'Reply' : 'Replies'}}
               </div>
               {{/if}}
               {{if children.length && !isCollapsed}}
                 <div class="children visible my-4 {{:depth < 2 ? 'pl-8 ml-[12px] border-l border-2-[#e9ebee]' : ''}}">
                   {{for children}}
                     {{include tmpl="#tmpl-item"/}}
                   {{/for}}
                 </div>
               {{/if}}
             </div>
             {{/if}}
    </script>

    <script src="https://unpkg.com/mic-recorder-to-mp3@2.2.1/dist/index.min.js"></script>

    <script type="module" src="../src/main.js"></script>

    <div id="toast-container" class="toast-container"></div>

    <div
      id="file-preview-modal"
      class="hidden fixed inset-0 bg-black/75 flex items-center justify-center z-[99]"
    >
      <div
        class="modal-content bg-white p-4 m-4 rounded relative max-w-full max-h-full"
      >
        <div id="preview-container" class="max-h-[80vh] overflow-auto"></div>
      </div>
      <a
        id="download-preview"
        href="#"
        download
        class="absolute top-2 left-2 cursor-pointer"
      >
        <i class="fa-solid fa-download text-white text-2xl"></i>
      </a>
      <div
        id="close-file-preview"
        class="absolute top-2 cursor-pointer right-2 !p-0"
      >
        <i class="fa-solid fa-xmark text-white text-2xl"></i>
      </div>
    </div>
  </body>
</html>
